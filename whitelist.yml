## Whitelist file to filter out some of the differences detected by the checks.
# Each check has its own section, keyed by the check name.
# Each section can have multiple rules.
# Each rule defines a predicate in disjunctive normal form where the innermost
#   conditions are simple equality checks on particular values for fields in the check output.
# Each rule also provides an expiry date and a reason for the whitelist entry to exist.
#
# An example check section, with a single rule:
#RummagerContentMissingFromPublishingApi:
#  rules:
#    - predicate:
#      - index: 'service-manual'
#        format: 'manual_section'
#      - base_path: '/this-page-in-particular-needs-ignoring-as-well'
#      expiry: '2016-05-22'
#      reason: "service-manual (and one extra page) is not fully baked yet, but we'll be ready to handle it soon"


PublishingApiContentMissingFromRummager:
  rules:
    - predicate:
      - schema_name: 'email_alert_signup'
      - schema_name: 'special_route'
      - schema_name: 'financial_releases_geoblocker'
      - schema_name: 'finder_email_signup'
      - schema_name: 'financial_release'
      - schema_name: 'financial_releases_campaign'
      expiry: '3000-01-01'
      reason: "Format doesn't contain searchable information"

    - predicate:
      - schema_name: 'redirect'
      - schema_name: 'gone'
      - schema_name: 'unpublishing'
      expiry: '3000-01-01'
      reason: "Rummager indexes the new link, not the old one"

    - predicate:
      - content_id: '44861ffb-7955-4736-afe8-107eef2ecf43'
      - content_id: 'edfda596-b2db-4b1c-9544-4f0d4912a8f1'
      expiry: '2017-06-01'
      reason: "These manual sections have been redirected in router-data, so they shouldn't be in the search index. Will be fixed by future clean up of router data. Relates to https://trello.com/c/csue5VYU/646-specialist-publisher-manuals-have-missing-organisations-in-publishing-api"

    - predicate:
      - schema_name: 'taxon'
      expiry: '2017-01-01'
      reason: "Taxon is a new thing and shouldn't be visible to users"

    - predicate:
      - schema_name: 'topic'
        content_id: '76e9abe7-dac8-49f0-bb5e-53e4b0d2cdba'
      expiry: '3000-01-01'
      reason: "Topic main page"

    - predicate:
      - publishing_app: 'whitehall'
        schema_name: 'html_publication'
      expiry: '2017-01-01'
      reason: "We don't currently index html attachments (but perhaps we should?)"

    - predicate:
      - document_type: 'business_support'
      - document_type: 'completed_transaction'
      expiry: '3000-01-01'
      reason: |
        Business Support pages have always been kept out of the search
        index. This is probably because users should find these pages via the
        business support finder (https://www.gov.uk/business-finance-support-finder)

        Completed transactions don't provide value to the user, so we don't index
        these as well.

        Panopticon decides whether or not to index a thing based on the format:

        https://github.com/alphagov/panopticon/blob/master/app/models/rummageable_artefact.rb#L3

    - predicate:
      - document_type: 'campaign'
      expiry: '2017-07-01'
      reason: "In progress: https://trello.com/c/fAF7mZ2H"

    - predicate:
      - publishing_app: 'hmrc-manuals-api'
      expiry: '2016-12-01'
      reason: 'Previously investigated here: https://trello.com/c/nI9RYIpX - this may need revisiting'

    - predicate:
      - publishing_app: 'service-manual-publisher'
      expiry: '2016-12-01'
      reason: 'Service Manual team are working on this'

    - predicate:
      - publishing_app: 'share-sale-publisher'
      expiry: '3000-01-01'
      reason: 'Share sale pages are going away soon'

    - predicate:
      - content_id: 'ccb6c301-2c64-4a59-88c9-0528d0ffd088'
      - content_id: 'd6582d48-df19-46b3-bf84-9157192801a6'
      expiry: '3000-01-01'
      reason: "policy-publisher has two hardcoded finders which we don't include in Rummager and don't need to fix"


RummagerContentMissingFromPublishingApi:
  rules:
    - predicate:
      - index: 'service-manual'
      expiry: '2016-08-14'
      reason: "We don't think any service manual content has made it into publishing-api yet - it's being rewritten"

    - predicate:
      - format: operational_field
      expiry: '2016-12-01'
      reason: "Being worked on by core-formats: https://trello.com/c/0UAMj5gj"

    - predicate:
      - format: inside-government-link
      expiry: '3000-01-01'
      reason: "These are internal links added by recommended links. Don't belong in Publishing API."

    - predicate:
      - format: recommended-link
      expiry: '3000-01-01'
      reason: "Recommended links don't belong in Publishing API."

    - predicate:
      - format: custom-application
        index: mainstream
        base_path: '/gwyliau-banc'
      expiry: '2017-07-01'
      reason: "We don't think this is important enough to fix right now. Check again in a year."

    - predicate:
      - format: worldwide_organisation
        index: government
        base_path: '/government/world/organisations/uk-representation-in-the-commonwealth'
      expiry: '2017-07-01'
      reason: "We don't think this is important enough to fix right now. Check again in a year."

    - predicate:
      - base_path: '/guidance/how-to-appeal-your-rateable-value'
      - base_path: '/government/news/cma-opens-consultation-on-reed-elsevier-undertakings'
      - base_path: '/government/world-location-news/uk-visa-operations-in-south-india-are-impacted-by-the-floods-in-chennai'
      - base_path: '/government/collections/common-land-guidance-for-commons-registration-authorities-and-applicants'
      - base_path: '/government/news/rpa-remains-on-track-to-pay-bps-2015-claims-from-december'
      - base_path: '/government/speeches/ghana-oil-and-gas-for-inclusive-growth'
      - base_path: '/government/news/hoac-pre-planning-application-engagement-event-19-march-2016-harefield'
      - base_path: '/ask-crown-court-sentence-review'
      expiry: '2016-09-01'
      reason: "Whitelisting this while several of Mo's PRs get deployed"

RummagerLinkTargetsMissingFromPublishingApi:
  rules:
    - predicate:
      - link_type: 'people'
      expiry: '2017-06-01'
      reason: "We're not going to look at people links for a long time - let's reassess next year"

    - predicate:
      - link_type: 'organisations'
        link: null
      expiry: '2017-10-01'
      reason: "Some corporate information pages and finders have an organisation link with only a slug. https://trello.com/c/zx42y5Mk"

LinksMissingFromRummager:
  rules:
    - predicate:
      - link_type: 'people'
      expiry: '2017-06-01'
      reason: "We're not going to look at people links for a long time - let's reassess next year"

    - predicate:
      - link_type: 'mainstream_browse_pages'
        base_path: '/pedlars-certificate'
        link_base_path: '/browse/business/sale-goods-services-data'
      - link_type: 'mainstream_browse_pages'
        base_path: '/employee-ownership'
        link_base_path: '/browse/employing-people/contracts'
      - link_type: 'mainstream_browse_pages'
        base_path: '/apply-special-educational-needs-assessment'
        link_base_path: '/browse/disabilities/equipment'
      - link_type: 'mainstream_browse_pages'
        base_path: '/apply-special-educational-needs-assessment'
        link_base_path: '/browse/births-deaths-marriages/child-adoption'
      expiry: '2016-09-01'
      reason: "These links are all missing from rummager. Publishing api is correct. Content team are going to republish."

    - predicate:
      - link_type: 'mainstream_browse_pages'
        base_path: '/international-child-abduction'
        link_base_path: '/browse/abroad/travel-abroad'
      expiry: '2016-09-01'
      reason: "This link is missing from rummager but exists in rummager. But the content is withdrawn. We should just remove the old link."

    - predicate:
      - link_type: 'organisations'
      expiry: '2016-09-01'
      reason: "Deal with this after automating the links checker."

RummagerLinkTargetsMissingFromRummager:
  rules:
    - predicate:
      - link_type: 'people'
      expiry: '2017-06-01'
      reason: "We're not going to look at people links for a long time - let's reassess next year"

    - predicate:
      - link_type: 'working_groups'
      expiry: '3000-01-01'
      reason: 'Not interested in working groups right now.'

    - predicate:
      - link_type: 'organisations'
      - link_type: 'topics'
      expiry: '2017-06-01'
      reason: 'It seems we have a truckload of false positives for organisations and topics. Impact: searching by organisation may not be complete. https://trello.com/c/6pyJIP1D'

LinksMissingFromPublishingApi:
  rules:
    - predicate:
      - link_type: 'people'
      expiry: '2017-06-01'
      reason: "We're not going to look at people links for a long time - let's reassess next year"
    - predicate:
      - schema_name: redirect
      expiry: '3000-01-01'
      reason: We shouldn't index redirects in search.
    - predicate:
      - publishing_app: 'publisher'
        content_id: af54e529-5419-4816-b6bd-d5df3f9652f6
      - publishing_app: 'publisher'
        content_id: b2c17c88-1701-427e-b1bb-02b05eef9c44
      - publishing_app: 'publisher'
        content_id: db364fa7-96c5-42c2-a3db-ce06d4a7c97e
      - publishing_app: 'publisher'
        content_id: 7a4bc8d3-c563-466b-b07b-bedd58650e40
      - publishing_app: 'publisher'
        content_id: c119b045-544b-4851-92e5-29b683255751
      - publishing_app: 'publisher'
        content_id: 17e1c741-1a7f-45ec-8532-7c787f35003d
      - publishing_app: 'publisher'
        content_id: 6cc57294-2821-4c49-bd7a-0a960089626d
      - publishing_app: 'publisher'
        content_id: 7a4bc8d3-c563-466b-b07b-bedd58650e40
      - publishing_app: 'publisher'
        content_id: bb148231-a649-4ed0-9eb6-8b40965179b7
      - publishing_app: 'publisher'
        content_id: f4b96a38-5247-4afd-b554-8a258a0e8c93
      expiry: '2017-01-01'
      reason: 'Links deleted in content api. Rummager has historically not removed links. This may be corrected when rummager content is sourced from the publishing api queue.'

    - predicate:
      - base_path: '/reporting-road-obstruction'
        format: 'placeholder'
        link_base_path: '/browse/housing/recycling-rubbish'
      - base_path: '/report-debris-motorways-main-road'
        format: 'placeholder'
        link_base_path: '/browse/housing/recycling-rubbish'
      - base_path: '/apply-building-regulation-approval-from-council'
        format: 'placeholder'
        link_base_path: '/browse/housing/planning-permission'
      expiry: '3000-01-01'
      reason: 'Placeholder content that is redirected. Rummager and publishing api both have the old item, but publishing api never got the links.'

    - predicate:
      - base_path: '/employee-ownership'
        link_base_path: '/browse/business/setting-up'
      - base_path: '/employee-reservist'
        link_base_path: '/browse/employing-people/payroll'
      - base_path: '/employee-reservist'
        link_base_path: '/topic/business-tax/PAYE'
      - base_path: '/register-biomass-supplier'
        link_base_path: '/browse/benefits-heating'
      - base_path: '/hunting'
        link_base_path: '/browse/environment-countryside'
      - base_path: '/pedlars-certificate'
        link_base_path: '/browse/business/setting-up'
      expiry: '2016-09-01'
      reason: 'Rummager has some extra links that should be removed. Raising with content team.'

    - predicate:
      - publishing_app: 'whitehall'
        content_id: 932dbd8c-12c5-46a6-8ca2-bc42113ae291
      - publishing_app: 'whitehall'
        content_id: 945dd603-4550-4b39-b92d-cb6f2d04be55
      expiry: '2017-01-01'
      reason: 'Some withdrawn documents that lost their links in publishing api. https://trello.com/c/nOhlbdQT/50-withdrawn-reports-no-longer-tagged-to-dfh'

    - predicate:
      - publishing_app: 'whitehall'
        link_type: 'topic'
        base_path: '/government/collections/river-basin-management-plans-update'
      expiry: '2016-09-01'
      reason: 'See https://trello.com/c/ouFmYN9S/55-rummager-data-flooded-with-duplicate-tags'

    - predicate:
      - link_base_path: '/topic/competition/mergers'
        base_path: '/government/news/cma-opens-consultation-on-reed-elsevier-undertakings'
      - link_base_path: '/topic/environmental-management/land-management'
        base_path: '/government/collections/common-land-guidance-for-commons-registration-authorities-and-applicants'
      expiry: '2017-09-01'
      reason: 'Redirected content, but not a redirect in publishing api. We can probably ignore this.'

    - predicate:
      - base_path: '/government/publications/markets-orders-and-undertakings-register'
      - base_path: '/government/collections/planning-and-economic-development'
      expiry: '2016-09-01'
      reason: 'Missing link in publishing api. https://trello.com/c/IsMZN5wj/56-inconsistent-topic-tagging-for-whitehall-content'

RedirectedRummagerContent:
  rules:
    - predicate:
      - publishing_app: 'whitehall'
      - publishing_app: 'hmrc-manuals-api'
      expiry: '2017-06-14'
      reason: 'See https://trello.com/c/oDkd28x5/649-items-not-getting-updated-in-rummager-when-redirected-in-publishing-api - This is content that has been redirected but the original link is still in rummager. This means users could see duplicate results with different links. We made a decision to not check this now'
