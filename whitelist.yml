# Whitelist file to filter out some of the differences detected by the checks.
# Each check has its own section, keyed by the check name.
# Each section can have multiple rules.
# Each rule defines a predicate in disjunctive normal form where the innermost
#   conditions are simple equality checks on particular values for fields in the check output.
# Each rule also provides an expiry date and a reason for the whitelist entry to exist.
#
# An example check section, with a single rule:
#BasePathsMissingFromPublishingApi:
#  rules:
#    - predicate:
#      - index: 'service-manual'
#        format: 'manual_section'
#      - base_path: '/this-page-in-particular-needs-ignoring-as-well'
#      expiry: '2016-05-22'
#      reason: "service-manual (and one extra page) is not fully baked yet, but we'll be ready to handle it soon"


BasePathsMissingFromRummager:
  rules:
    - predicate:
      - schema_name: 'email_alert_signup'
      - schema_name: 'special_route'
      - schema_name: 'financial_releases_geoblocker'
      - schema_name: 'finder_email_signup'
      - schema_name: 'financial_release'
      - schema_name: 'financial_releases_campaign'
      expiry: '3000-01-01'
      reason: "Format doesn't contain searchable information"

    - predicate:
      - schema_name: 'redirect'
      - schema_name: 'gone'
      - schema_name: 'unpublishing'
      expiry: '3000-01-01'
      reason: "Rummager indexes the new link, not the old one"

    - predicate:
      - content_id: '44861ffb-7955-4736-afe8-107eef2ecf43'
      - content_id: 'edfda596-b2db-4b1c-9544-4f0d4912a8f1'
      expiry: '2017-06-01'
      reason: "These manual sections have been redirected in router-data, so they shouldn't be in the search index. Will be fixed by future clean up of router data. Relates to https://trello.com/c/csue5VYU/646-specialist-publisher-manuals-have-missing-organisations-in-publishing-api"

    - predicate:
      - schema_name: 'taxon'
      expiry: '2017-01-01'
      reason: "Taxon is a new thing and shouldn't be visible to users"

    - predicate:
      - schema_name: 'topic'
        content_id: '76e9abe7-dac8-49f0-bb5e-53e4b0d2cdba'
      expiry: '3000-01-01'
      reason: "Topic main page"

    - predicate:
      - publishing_app: 'whitehall'
        schema_name: 'html_publication'
      expiry: '2017-01-01'
      reason: "We don't currently index html attachments (but perhaps we should?)"

    - predicate:
      - schema_name: 'inside-government-link'
      expiry: '3000-01-01'
      reason: "These are internal links added by recommended links. Don't belong in Publishing API."

    - predicate:
      - publishing_app: 'policy-publisher'
      expiry: '2016-07-01'
      reason: 'Investigating: https://trello.com/c/xARBi6HF'

    - predicate:
      - document_type: 'business_support'
      - document_type: 'completed_transaction'
      expiry: '3000-01-01'
      reason: |
        Business Support pages have always been kept out of the search
        index. This is probably because users should find these pages via the
        business support finder (https://www.gov.uk/business-finance-support-finder)

        Completed transactions don't provide value to the user, so we don't index
        these as well.

        Panopticon decides whether or not to index a thing based on the format:

        https://github.com/alphagov/panopticon/blob/master/app/models/rummageable_artefact.rb#L3

    - predicate:
      - document_type: 'campaign'
      expiry: '2017-07-01'
      reason: "In progress: https://trello.com/c/fAF7mZ2H"

    - predicate:
      - publishing_app: 'collections-publisher'
      expiry: '2016-07-01'
      reason: 'Investigating: https://trello.com/c/hLGohIrz'

    - predicate:
      - publishing_app: 'hmrc-manuals-api'
      expiry: '2016-07-01'
      reason: 'Investigating: https://trello.com/c/nI9RYIpX'

    - predicate:
      - publishing_app: 'service-manual-publisher'
      expiry: '2016-12-01'
      reason: 'Service Manual team are working on this'

    - predicate:
      - publishing_app: 'share-sale-publisher'
      expiry: '3000-01-01'
      reason: 'Share sale pages are going away soon'

BasePathsMissingFromPublishingApi:
  rules:
    - predicate:
      - index: 'service-manual'
      expiry: '2016-08-14'
      reason: "We don't think any service manual content has made it into publishing-api yet - it's being rewritten"

    - predicate:
      - format: operational_field
      expiry: '2016-07-01'
      reason: "Being worked on: https://trello.com/c/0UAMj5gj"

    - predicate:
      - format: inside-government-link
      expiry: '3000-01-01'
      reason: "These are internal links added by recommended links. Don't belong in Publishing API."

    - predicate:
      - format: publication
        index: government
      expiry: '2016-07-01'
      reason: "This is caused by statistics/publications base path confusion. https://trello.com/c/gIPdZfk3"

LinkedBasePathsMissingFromPublishingApi:
  rules:
    - predicate:
      - link_type: 'people'
      expiry: '2017-06-01'
      reason: "We're not going to look at people links for a long time - let's reassess next year"

LinksMissingFromRummager:
  rules:
    - predicate:
      - link_type: 'people'
      expiry: '2017-06-01'
      reason: "We're not going to look at people links for a long time - let's reassess next year"

    - predicate:
      - schema_name: 'email_alert_signup'
      - schema_name: 'special_route'
      - schema_name: 'financial_releases_geoblocker'
      - schema_name: 'finder_email_signup'
      - schema_name: 'financial_release'
      - schema_name: 'financial_releases_campaign'
      expiry: '3000-01-01'
      reason: "Format doesn't contain searchable information"

    - predicate:
      - schema_name: 'redirect'
      - schema_name: 'gone'
      - schema_name: 'unpublishing'
      expiry: '3000-01-01'
      reason: "Rummager indexes the new link, not the old one"

    - predicate:
      - schema_name: 'taxon'
      expiry: '2017-01-01'
      reason: "Taxon is a new thing and shouldn't be visible to users"

    - predicate:
      - schema_name: 'topic'
        content_id: '76e9abe7-dac8-49f0-bb5e-53e4b0d2cdba'
      - schema_name: 'mainstream_browse_page'
        content_id: '8413047e-570a-448b-b8cb-d288a12807dd'
      expiry: '3000-01-01'
      reason: "/topic and /browse should not be in search"

    - predicate:
      - publishing_app: 'whitehall'
        schema_name: 'html_publication'
      expiry: '2017-01-01'
      reason: "We don't currently index html attachments (but perhaps we should?)"

RummagerLinksNotIndexedInRummager:
  rules:
    - predicate:
      - link_type: 'people'
      expiry: '2017-06-01'
      reason: "We're not going to look at people links for a long time - let's reassess next year"
    - predicate:
      - link_type: 'organisations'
        link: null
      expiry: '2016-06-14'
      reason: 'https://trello.com/c/pFNSVJqm/648-organisations-hash-in-rummager-missing-the-link-field'
    - predicate:
      - link_type: 'mainstream_browse_pages'
      expiry: '2016-06-14'
      reason: 'https://trello.com/c/KufxB8Sv/650-item-links-not-getting-updated-in-rummager-when-the-link-target-is-redirected-in-publishing-api'
    - predicate:
      - link_type: 'working_groups'
      expiry: '3000-01-01'
      reason: 'Not interested in working groups right now.'

LinksMissingFromPublishingApi:
  rules:
    - predicate:
      - link_type: 'people'
      expiry: '2017-06-01'
      reason: "We're not going to look at people links for a long time - let's reassess next year"
    - predicate:
      - link_type: 'organisations'
        publishing_app: 'specialist-publisher'
      expiry: '2016-06-14'
      reason: 'https://trello.com/c/csue5VYU/646-specialist-publisher-manuals-have-missing-organisations-in-publishing-api'
    - predicate:
      - schema_name: 'placeholder_organisation'
        link_type: 'organisations'
      expiry: '2016-07-01'
      reason: 'Organisations are tagged to itself. https://trello.com/c/aOTMr3WJ'
    - predicate:
      - schema_name: 'hmrc_manual_section'
        link_type: 'organisations'
      expiry: '2016-07-01'
      reason: "HMRC Manuals API doesn't tag manual sections yet: https://trello.com/c/ofpGSyzO"
    - predicate:
      - schema_name: redirect
      expiry: '3000-01-01'
      reason: We shouldn't index redirects in search.
    - predicate:
      - publishing_app: 'service-manual-publisher'
      expiry: '2017-01-01'
      reason: 'In progress: https://trello.com/c/2PX73XvD'

RummagerRedirectedLinks:
  rules:
    - predicate:
      - link_type: 'mainstream_browse_pages'
        document_publishing_app: 'publisher'
      expiry: '2016-06-14'
      reason: 'https://trello.com/c/CZK3bygv - we are whitelisting these until we turn on indexing from publishing-api, since the links in publishing-api are correct.'

RummagerRedirects:
  rules:
    - predicate:
      - publishing_app: 'whitehall'
      - publishing_app: 'hmrc-manuals-api'
      expiry: '2016-06-14'
      reason: 'https://trello.com/c/oDkd28x5/649-items-not-getting-updated-in-rummager-when-redirected-in-publishing-api'
    - predicate:
      - publishing_app: 'service-manual-publisher'
      expiry: '2016-08-14'
      reason: "We don't think any service manual content has made it into publishing-api yet - it's being rewritten"
